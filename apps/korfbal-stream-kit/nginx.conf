server {
    listen 80;
    server_name localhost;

    # Dit is de 'root' map waar Nginx de bestanden zoekt.
    # Deze MOET matchen met de COPY-bestemming in je Dockerfile.
    root /usr/share/nginx/html;
    index index.html index.htm;
    # 1. Frontend: React Router ondersteuning
    # Dit is de 'magic' voor React Router / single-page applications (SPA).
    location / {
        # 1. Probeert het bestand $uri (bv. /logo.png) te vinden.
        # 2. Probeert de map $uri/ (bv. /admin/) te vinden.
        # 3. Als beide mislukken, stuur /index.html (de React-app).
        try_files $uri $uri/ /index.html;
    }

    # 2. Proxy alle verzoeken die beginnen met /api naar de backend container
    location /api/ {
      # Geen slash aan het einde van de URL!
      # Nginx stuurt /api/persons door als http://korfbal-streamz-api:3333/api/persons
      proxy_pass http://korfbal-streamz-api:3333;

      # EssentiÃ«le Headers
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;

      # Goed voor WebSockets (indien je die later gebruikt)
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection 'upgrade';
      proxy_cache_bypass $http_upgrade;
    }

    # 3. Caching voor assets
    location ~* \.(?:css|js|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public";
    }
}
